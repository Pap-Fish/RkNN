# RkNN
Rknn Search in Tree decomposition



File introduction:
NY-d.gr is the graph file. First line has two integers. They mean the vertex number n and the edge number m. The following m lines, each line has three integers x, y and z. They mean there is a edge between x and y with weight z.
NY-d.co is the latitude and longitude file.
NY-d.0.001-0.001.obj is the object and candidate file. the first 0.001 represent the density of candidate objects, the second number represent the density of users. First line has two integers. They means the object number |O| and user number |U|. The following lines has a char q/u and a integers: x. q means this vertex is candidate object, while u means it's a user. x is the vertex id.
NY_partition.txt is the subgraph partition file generated by METIS. First line has one integer, which means the subgraph number. The following lines, each line has two integers x and y. They mean vertex x belongs to subgraph y.
NY-0.001-0.001.rknn-10.query is the query file. First line has one integer, which means the number of query n. The following n lines, each line has two integers x,K. They mean query the rKnn of vertex x.
TkNN.cpp implementes the H2H and TEN-Index for shortest distance and knn query.

Operation 1: generate object
app_name graph_file objects_density user_density output_dir
    For example:
	./generate_object NY-d.gr 0.001 0.001 ./NY


Operation 2: construct tree decomposition index
app_name graph_name index_name
    For example:
    ./Tree-Decomposition.index NY-d.gr NY-d.index


Operation 3: generate query
app_name graph_name objects_density user_density k query_times random output_dir
    For example:
	./generate_query NY 0.001 0.001 10 1000 random ./NY


Operation 4: RkNN query with TBUF
Compile:  g++ graph.cpp TkNN.cpp TBUFexp.cpp -o TBUFexp -O3
Run:  
app_name graph_name index_name object_file -q query_file methodType log_file
parameter methodType:
	1. default: Eager algorithm
	2. corex: COREX algorithm
    3. td: TD-Query
	4. branchopt: TBUF-Query
For example:
    ./TBUFexp ./dataSet/NY-d.gr ./dataSet/NY-d.index ./dataSet/NY/NY-d.0.001-0.001.obj -q ./query/NY/NY-0.001-0.001.rknn-10.query branchopt ./result.txt


Operation 5: RkNN query with SMPV
Compile:  g++ graph.cpp SMPV.cpp TkNN.cpp SMPVExp.cpp -o SMPVExp -O3
Run:  
1. first run,  use the partition file
app_name graph_name -b partition_file -q object_file index_file query_file log_file
   For example:
	./SMPVExp ./dataSet/NY-d.gr -b ./dataSet/NY_partition.txt -q ./dataSet/NY/NY-d.0.001-0.001.obj ./dataSet/NY-d.index ./query/NY/NY-0.001-0.001.rknn-10.query ./result.txt
after first run, it will generate a smpv file to store the information of SMPV
2. run with smpv file
app_name graph_name -r smpv_file -q object_file index_file query_file log_file
   For example:
	./SMPVExp ./dataSet/NY-d.gr -r ./dataSet/NY-d.smpv -q ./dataSet/NY/NY-d.0.001-0.001.obj ./dataSet/NY-d.index ./query/NY/NY-0.001-0.001.rknn-10.query ./result.txt